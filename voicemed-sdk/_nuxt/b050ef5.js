(window.webpackJsonp=window.webpackJsonp||[]).push([[25,10],{923:function(t,e,i){"use strict";i(5),i(7),i(8),i(9);var r=i(179),s=i(24),o=i(26),n=(i(98),i(0),i(28),i(62),i(63),i(27),i(37),i(221),i(10),i(6),i(220),i(112),i(3),i(46));function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){Object(o.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"basePage",transition:{name:"slide",mode:"out-in",css:!1,beforeEnter:function(t){if(!document.querySelector("#__nuxt").classList.contains("quit")){var e=document.querySelector("#__nuxt").classList.contains("back")?"-100%":"100%";this.$anime.set(t,{scale:1,opacity:0,translateX:e})}},enter:function(t,e){var i=document.querySelector("#__nuxt").classList.contains("back")?"-100%":"100%";this.$anime({targets:t,opacity:[0,1],translateX:[i,"0"],duration:500,easing:"easeInOutSine",complete:e})},leave:function(t,e){if(document.querySelector("#__nuxt").classList.contains("quit"))this.$anime({targets:t,translateY:[0,"100%"],duration:500,easing:"easeInOutSine",complete:e});else{var i=document.querySelector("#__nuxt").classList.contains("back")?"100%":"-100%";this.$anime({targets:t,opacity:[1,0],translateX:["0",i],duration:500,easing:"easeInOutSine",complete:e})}},afterLeave:function(t){document.querySelector("#__nuxt").classList.remove("quit"),document.querySelector("#__nuxt").classList.remove("back")}},data:function(){return{name:"basePage",exid:this.$route.params.id,programid:this.$route.params.fromprogram||!1,withindex:this.$route.params.withindex||-1,backto:this.$route.params.backto||!1,hasBack:!1,hasNext:!1,hasInfo:!1,currentTutorial:!1,tutorialList:[],tutorialShownHard:!1}},computed:c(c({},Object(n.d)({getCurrentPagerHeight:"getCurrentPagerHeight",getTutorialShown:"getTutorialShown",getLocalTutorialShown:"getLocalTutorialShown"})),{},{isVoicemed:function(){return $nuxt.$config.env.environment.indexOf("voicemed_")>-1},isAirlyn:function(){return $nuxt.$config.env.environment.indexOf("voicemed_")<0},nuxtloading:function(){return $nuxt.$loading.loading},defaultHomeUrl:function(){return"/user/today"}}),methods:c(c({},Object(n.c)({setCurrentPage:"setCurrentPage",setCurrentPagerHeight:"setCurrentPagerHeight",setTutorialRunPerPage:"setTutorialRunPerPage",setTutorialRun:"setTutorialRun"})),{},{setTutorialRunLocal:function(){this.setPreferenceTutorial()},tutorialClose:function(){this.$set(this,"tutorialList",[]),this.setTutorialRunLocal(),this.currentTutorial=null},tutorialHasNext:function(){var t=this.currentTutorial.index;return!!this.tutorialList.find((function(e){return e.index===t+1}))},exerciseStepBack:function(){console.log("exit test",this.backto,this.programid),"standalone"!=this.backto?"today"!=this.backto?"discovery"!=this.backto?this.programid?"-1"==this.programid||-1==this.programid||"false"==this.programid||0==this.programid?$nuxt.$router.replace($nuxt.localePath("/user/today")):$nuxt.$router.replace($nuxt.localePath("/ml/programs/"+this.programid)):$nuxt.$router.replace($nuxt.localePath("/user/today")):$nuxt.$router.replace($nuxt.localePath("/home")):$nuxt.$router.replace($nuxt.localePath("/user/today")):$nuxt.$airlyn.finishExercise({reason:"user-cancelled",result:{}}).finally((function(){console.log("exercise finished by user")}))},buildSuffix:function(){var t=[],e=!!this.programid&&this.programid;return t.push("-1"!==e&&e),t.push(this.withindex?this.withindex:"-1"),t.push(!!this.backto&&this.backto),t.join("/")},tutorialNext:function(){var t=this.currentTutorial?this.currentTutorial.index:0;this.currentTutorial?(this.currentTutorial.visible=!1,this.setTutorialRunLocal()):t=this.tutorialList[0].index-1;var e=this.tutorialList.find((function(e){return e.index===t+1}));if(e){this.currentTutorial=e;e.position.height;var i=e.position.top>this.appHeight/2?e.position.top-210:e.position.top-10;e.arrowTop&&(i=e.position.top-(e.position.height+10)),i=Math.max(0,i),console.warn("Nuovo scroll Top:",i,this.appHeight,this.footerHeight,e.position.height),this.$nextTick((function(){document.querySelector(".indexPage").scrollTo({top:i,left:0,behavior:"smooth"})})),e.visible=!0}else this.tutorialClose()},getTutorialIndex:function(){return this.currentTutorial?this.currentTutorial.index>this.tutorialList.length?this.tutorialList.length:this.currentTutorial.index:""},getTutorialText:function(t){return this.$t("tutorials."+this.name+".text_"+t.index,{title:t.title})},getTutorialDialogStyle:function(t){var e={},i=t.position,r=i.top;return this.$capacitor&&this.$capacitor.isNativePlatform()&&0==t.updated&&(r=i.top,t.updated=!0,console.warn("apply tutorial offset for mobile phones")),e.top=r>300?r-200+"px":r+i.height+10+"px",console.warn("DialogStyle for tutorial",t,e),"fill"!==t.width?e.left="calc("+i.left+"px - 75vw + "+i.width+"px )":(e.left="0px",e.right="0px"),Object.entries(e).map((function(t){var e=Object(s.a)(t,2),i=e[0],r=e[1];return"".concat(i,":").concat(r)})).join(";")},getTutorialStyle:function(t){var e={},i=t.position,r=i.top;return this.$capacitor&&this.$capacitor.isNativePlatform()&&0==t.updated&&(r=i.top,t.updated=!0),console.warn("Style for tutorial",t,r),"fill"===t.width?(e.top=r-4+"px",e.left="0px",e.right="0px",e.height=i.height+8+"px"):(e.top=r-4+"px",e.left=i.left-4+"px",e.right="0px",e.height=i.height+8+"px",e.width=i.width+8+"px"),Object.entries(e).map((function(t){var e=Object(s.a)(t,2),i=e[0],r=e[1];return"".concat(i,":").concat(r)})).join(";")},initTutorial:function(){var t=this,e=Object(r.a)(document.querySelectorAll(".hastutorial")),i=!1;if(this.$capacitor&&this.$capacitor.isNativePlatform()?i=this.tutorialShownHard:(this.tutorialShownHard=this.$nuxt.$store.getters.getTutorialRun(this.name),i=this.$nuxt.$store.getters.getTutorialRunPerPage(this.name)),void 0!==this.getTutorialShown[this.name]||i||this.tutorialShownHard)console.warn("hide tutorial, not needed at this round");else{if(this.$set(this,"tutorialList",[]),e.length>0){document.querySelector(".indexPage").scrollTo({top:0,left:0,behavior:"smooth"});var s=this.getLocalTutorialShown;console.warn("got local tutorials",s),e.forEach((function(e){var i=parseInt(e.dataset.tutorialindex);if(void 0===s[t.name+"_"+i]){var r=e.getBoundingClientRect();t.tutorialList.push({position:r,visible:!1,itemRef:e,updated:!1,arrowTop:"top"==e.dataset.tutorialarrow,title:e.dataset.tutorial,width:e.dataset.tutorialwidth,index:i})}})),window.tutorialList=this.tutorialList}this.tutorialList.length>0&&(this.tutorialList=this.tutorialList.sort((function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}))),this.tutorialList.length>0&&(this.currentTutorial=0,this.$nextTick((function(){setTimeout((function(){t.tutorialList.forEach((function(t){t.position=t.itemRef.getBoundingClientRect()})),t.tutorialNext(),t.setTutorialRunPerPage(t.name)}),200)})))}},hasJoinedProgramById:function(t){return this.$nuxt.$store.getters.hasJoinedProgramById(t)},getProgramJoinedAtById:function(t){return this.$nuxt.$store.getters.getProgramJoinedAtById(t)},getProgramById:function(t){return this.$nuxt.$store.getters.getProgramById(t)},getOverallProgressProgramById:function(t){return this.$nuxt.$store.getters.getOverallProgressProgramById(t)},getDoneCountByProgramId:function(t){return this.$nuxt.$store.getters.getDoneCountByProgramId(t)},getNextExerciseByProgramId:function(t){return this.$nuxt.$store.getters.getNextExerciseByProgramId(t)},getExercisetocompleteCountProgramById:function(t){return this.$nuxt.$store.getters.getExercisetocompleteCountProgramById(t)},getExercisecompletedCountProgramById:function(t){return this.$nuxt.$store.getters.getExercisecompletedCountProgramById(t)},printDeviceError:function(t,e,i,r){this.$analytics.logEvent("permission_error",{title:"errors."+t+"."+e.name.toLowerCase()+".title",kind:t}),console.error("Got device error",e),!e||"NotAllowedError"!==e.name&&"NotFoundError"!==e.name&&"denied"!=e.exception.state&&"DENIED"!=e.exception.state?this.showError(this.$t("errors.generic.title"),this.$t("errors.generic.description"),i,r):this.$root.$emit("showPermssionError",!0)},printDeviceErrorOLD:function(t,e,i,r){if(this.$analytics.logEvent("permission_error",{title:"errors."+t+"."+e.name.toLowerCase()+".title",kind:t}),console.error("Got device error",e),e.exception&&"mic"==t&&("denied"==e.exception.state||"DENIED"==e.exception.state))return e.name="DeniedError",void this.$root.$emit("showError",{title:this.$t("errors."+t+"."+e.name.toLowerCase()+".title"),error:this.$t("errors."+t+"."+e.name.toLowerCase()+".description"),hasretry:!0,click:function(){return $nuxt.$airlyn.openPermissionPanel().then((function(t){console.log("got openPermission Panel then",t,JSON.stringify(t))})).catch((function(t){console.log("got openPermission Panel catch",t,JSON.stringify(t))})).finally((function(){"function"==typeof r&&(console.log("dopo il setting riport cmq a inizio"),r())})),!0},resetEvent:r||function(){},retryBtn:"Settings"});!e||"NotAllowedError"!==e.name&&"NotFoundError"!==e.name?this.showError(this.$t("errors.generic.title"),this.$t("errors.generic.description"),i,r):this.showError(this.$t("errors."+t+"."+e.name.toLowerCase()+".title"),this.$t("errors."+t+"."+e.name.toLowerCase()+".description"),i,r)},manageMicError:function(t,e,i){this.printDeviceError("mic",t,e,i)},manageCamError:function(t,e,i){this.printDeviceError("cam",t,e,i)},manageMicCamError:function(t,e,i){this.printDeviceError("miccam",t,e,i)},showError:function(t,e,i,r){this.$root.$emit("showError",{title:t,error:e,hasretry:null!==i,click:i||function(){},resetEvent:r||function(){}})},swipeEvent:function(t){this.$root.$emit("swipe",t)},attachSwipeListener:function(){document.addEventListener("swiped-left",this.swipeEvent),document.addEventListener("swiped-right",this.swipeEvent)},detachSwipeListeners:function(){document.removeEventListener("swiped-left",this.swipeEvent),document.removeEventListener("swiped-right",this.swipeEvent)},retrievePreferenceTutorial:function(){var t=this;this.$capacitor&&this.$capacitor.isNativePlatform()&&this.$airlyn.preferenceConfigure({group:"airlyn"}).finally((function(){console.log("preferences ready");var e="tutorial_"+t.name;t.$airlyn.preferenceGet({key:e}).then((function(i){console.log("preference read ("+e+")!",i),i&&i.value&&(1===i.value||"1"==i.value)&&(console.log("got preference Tutorial SEEN for",e,i.value),t.tutorialShownHard=!0)}))}))},setPreferenceTutorial:function(){if(this.$capacitor&&this.$capacitor.isNativePlatform()){var t="tutorial_"+this.name;this.$airlyn.preferenceSet({key:t,value:"1"}).finally((function(){console.log("preference stored for!",t)}))}this.setTutorialRun({page:this.name,index:this.currentTutorial.index}),this.tutorialShownHard=!0}}),beforeMount:function(){console.log("PRE loaded base Page"),this.setCurrentPage(this)},beforeDestroy:function(){this.detachSwipeListeners()},mounted:function(){var t=this;console.log("loaded base Page"),this.tutorialShownHard=!1,this.retrievePreferenceTutorial(),console.log("try Load index",this.name,this.dynamicTexts),this.dynamicTexts&&Object.keys(this.dynamicTexts).length>0&&Object.keys(this.dynamicTexts).map((function(e){t.$appConfiguration.getText(e).then((function(i){t.dynamicTexts[e]=i})).catch((function(i){t.dynamicTexts[e]=t.$t(t.name+"."+e)}))})),null!==this.getCurrentPagerHeight&&document.querySelector(".v-main__wrap > div.pager")&&(document.querySelector(".v-main__wrap > div.pager").style.height=this.getCurrentPagerHeight+"px"),this.$nextTick((function(){if(t.$capacitor&&t.$capacitor.isNativePlatform())console.log("Richiesto al passaggio precedente");else{var e=t.getLocalTutorialShown;e&&void 0!==e[t.name]?t.tutorialShownHard=!0:t.tutorialShownHard=!1}t.attachSwipeListener(),null===t.getCurrentPagerHeight&&document.querySelector(".v-main__wrap > div.pager")&&t.setCurrentPagerHeight(Math.max(document.querySelector(".v-main__wrap > div.pager").clientHeight,document.querySelector(".v-main__wrap > div.pager").offsetHeight))}))}}},924:function(t,e,i){"use strict";i.r(e);i(5),i(50);var r={props:{title:{type:String,default:"Info"},transition:{type:String,default:"dialog-bottom-transition"},contentclasses:{type:String,default:""},description:{type:String,default:"Info text"},infoImage:{type:String,default:null},showSuperTitle:{type:Boolean,default:!0},thumbInTitle:{type:Boolean,default:!0},show:{type:Boolean,default:!1}},data:function(){return{}},computed:{showDialog:function(){return this.show}},methods:{closeClick:function(t){this.$emit("close",t)}},mounted:function(){}},s=i(42),o=Object(s.a)(r,(function(){var t=this,e=t._self._c;return e("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:t.transition,scrollable:"","content-class":"infoDialog "+t.contentclasses},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[e("fullpage-card",{scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{class:[(t.showSuperTitle?"with":"without")+"__supertitle",(t.thumbInTitle?"with":"without")+"__thumbInTitle"]},[t.showSuperTitle?e("div",{staticClass:"text-center supertitle"},[t._v("About")]):t._e(),t._v(" "),t.infoImage&&!0===t.thumbInTitle?e("img",{staticClass:"titleImage",attrs:{src:t.infoImage}}):t._e(),t._v(" "),e("div",{staticClass:"text-center infodialog__title",domProps:{innerHTML:t._s(t.title)}})])]},proxy:!0},{key:"body",fn:function(){return[e("div",{staticClass:"text-center content"},[t.infoImage&&!1===t.thumbInTitle?e("img",{staticClass:"errorimage",attrs:{src:t.infoImage}}):t._e(),t._v(" "),e("span",{class:[t.contentclasses,"withdynamicTexts"],domProps:{innerHTML:t._s(t.description)}})])]},proxy:!0},{key:"footer",fn:function(){return[e("div",{class:["pager"]},[e("v-btn",{attrs:{color:"nextvm",nuxt:""},on:{click:t.closeClick}},[t._t("closebtn",(function(){return[e("v-icon",[t._v("mdi-reload")]),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.$t("generic.done"))}})]}))],2)],1)]},proxy:!0}],null,!0)})],1)}),[],!1,null,null,null);e.default=o.exports;installComponents(o,{FullpageCard:i(219).default})},925:function(t,e,i){"use strict";i(3),i(5),i(7),i(0),i(8),i(6),i(9);var r=i(26),s=i(923),o=i(46);function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){Object(r.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"expage",mixins:[s.a],computed:a(a({},Object(o.d)({getExercises:"getExercises",getCurrentExercise:"getCurrentExercise"})),{},{exercise:function(){return this.getCurrentExercise}}),mounted:function(){console.log("monti pagina interna ex",this.getExercises,this.getCurrentExercise),this.getExercises||console.warn("Cannot retrieve exercise list in page"),0===this.getExercises.length&&console.error("Cannot retrieve exercise list in page")}}},933:function(t,e){function i(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i.keys=function(){return[]},i.resolve=i,t.exports=i,i.id=933},952:function(t,e,i){t.exports=i.p+"img/setup_phone_1.07a5762.png"},953:function(t,e,i){t.exports=i.p+"img/setup_phone_2.21b4908.png"},954:function(t,e,i){t.exports=i.p+"img/custom_setup_phone_1.9551095.png"},968:function(t,e,i){"use strict";i.r(e);i(27),i(3),i(5),i(7),i(8),i(9);var r=i(179),s=i(26),o=(i(0),i(6),i(37),i(28),i(62),i(40),i(112),i(925)),n=i(46);function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){Object(s.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}i(952),i(953),i(954),i(510),i(511);var l={name:"setup",mixins:[o.a],data:function(){return{exid:this.$route.params.id,programid:this.$route.params.fromprogram||!1,withindex:this.$route.params.withindex||!1,backto:this.$route.params.backto||!1,name:"setup",step:0,stepLast:3,stepBreak:2,hasVideoTutorial:!1,animate:!0,loading:!1,hasBack:!0,hasInfo:!1,grantAsked:!1,computeVideOverlayHeight:null,skipPermissions:!1,hasNext:!0,uuid:"0",video:null,about:{show:!1},medicalrisks:{show:!1},permissionPopup:{show:!1}}},transition:{name:"fade",mode:"out-in",css:!1,beforeEnter:function(t){this.$anime.set(t,{scale:1,opacity:0})},enter:function(t,e){this.$anime({targets:t,opacity:[0,1],duration:500,easing:"easeInOutSine",complete:e})},leave:function(t,e){this.$anime({targets:t,opacity:[1,0],duration:500,easing:"easeInOutSine",complete:e}),document.body.classList.remove("bodyblock")}},beforeRouteLeave:function(t,e,i){null!=window.stream&&window.stream.getTracks().forEach((function(t){t.stop()})),this.$root.$emit("showPager",{show:!0}),window.stream=null,i()},computed:c(c({},Object(n.d)({getExercises:"getExercises",getCurrentExercise:"getCurrentExercise"})),{},{useCustomTutorial:function(){return!!this.programid&&this.$exerciseManager.programHasCustomTutorialByProgramId(this.programid)},needsToShowHeader:function(){return this.step===this.stepBreak?"no-header":""},exercise:function(){return this.getCurrentExercise},playerId:function(){return"player-"+this.uuid}}),watch:{step:function(){this.$root.$emit("showPager",{show:!0})},grantAsked:function(){this.step>1?this.hasNext=this.grantAsked:this.hasNext=!0}},methods:c(c({},Object(n.c)({setCurrentExerciseIndex:"setCurrentExerciseIndex",setCurrentExerciseById:"setCurrentExerciseById"})),{},{skipAll:function(){this.startExercise()},openMedicalRisks:function(){this.medicalrisks.show=!0},fixVideoHeight:function(t,e){var i=t/e,r=document.getElementById("playerAreaTutorial");if(r){var s=document.body.clientHeight,o=document.body.clientWidth,n=r.closest(".fullPageCard"),a=n.querySelector("div.header"),c=n.querySelector("div.footer"),l=document.querySelector(".pager");a&&(s-=a.scrollHeight),c&&(s-=c.scrollHeight),l&&(s-=l.scrollHeight);var u=Math.min(s,n.scrollHeight-((a?a.scrollHeight:0)+(c?c.scrollHeight:0)));r.style.height=u+"px",r.style.width=u*i+"px",console.log("found H & W",u,u*i),n.querySelector("div.body").style.height=u-4+"px",n.querySelector("div.body").style.overflow="hidden",n.querySelector("div.body").classList.remove("horizontal"),u*i>o&&(n.querySelector("div.body").classList.add("horizontal"),r.style.width=o+"px",r.style.height=o/i+"px"),i>.9&&i<1.1&&(this.video.style.width=o+"px",this.video.style.height=o/i+"px")}},getTutorialImage:function(t,e){return"dob"==this.getCurrentExercise.subtype?this.getImage(this.$t(t+".voice_image_"+e)):this.useCustomTutorial?this.getImage(this.$t("custom_setup.image_"+e)):this.getImage(this.$t(t+".image_"+e))},getTutorialTitle:function(t,e){return"dob"==this.getCurrentExercise.subtype?this.$t(t+".voice_title_"+e):this.useCustomTutorial?this.$t("custom_setup.title_"+e):this.$t(t+".title_"+e)},getTutorialText:function(t,e){return"dob"==this.getCurrentExercise.subtype?this.$t(t+".voice_description_"+e):this.useCustomTutorial?this.$t("custom_setup.description_"+e):this.$t(t+".description_"+e)},getImage:function(t){return-1!==t.indexOf("~/assets")?i(933)(t):t},closeInfo:function(){this.about.show=!1},closeMdRisks:function(){this.medicalrisks.show=!1},infoStep:function(){console.log("got info click method [ex]"),this.about.show=!0},oncameraupdate:function(t){console.log("got event from camera",t),"initVideoCapture"===t.event&&(this.hasNext=!1),"finishinitStream"===t.event&&(this.hasNext=!0)},blockClick:function(){return this.exerciseStepBack(),!0},moveToNext:function(){var t=this;this.$capacitor.isNativePlatform()?this.$airlyn.checkMicPerm().then((function(e){if(console.log("Permessi al microfono garantiti?",e),e&&!0===e.result)t.startExercise();else{var i={name:$nuxt.$t("errors.global.msg_notallowed"),exception:e};t.manageMicError(i,null,(function(){return this.exerciseStepBack(),!0}))}})).catch((function(e){console.error("Permission request fails",e),t.manageMicError({name:$nuxt.$t("errors.global.msg_notallowed"),exception:e},null,(function(){return this.exerciseStepBack(),!0}))})):this.$checkPermissions().then((function(e){window.stream=e,t.startExercise()})).catch((function(e){console.error("[checkPermissions] allow error",e),t.$captureException(e),t.manageMicCamError(e,null,(function(){return this.exerciseStepBack(),!0}))})).finally((function(){t.$nuxt.$loading.finish(),t.$closeStream()}))},allowClickSecond:function(){var t=this;this.$nuxt.$loading.start(),this.grantAsked=!0,this.$capacitor.isNativePlatform()?this.$airlyn.requestWholePermissions().then((function(e){console.log("Permessi garantiti?",e),(!e||!0!==e.storage||!0!==e["voice recording"]&&!0!==e.microphone)&&(console.error("[checkPermissions] allow error"),t.manageMicCamError({name:$nuxt.$t("errors.global.msg_notallowed")},null,(function(){return this.exerciseStepBack(),!0})))})).catch((function(e){console.error("[checkPermissions] allow error",e),t.$captureException(e),t.manageMicCamError(e,null,(function(){return this.exerciseStepBack(),!0}))})).finally((function(){t.$nuxt.$loading.finish(),console.log("Close permission popup - native"),t.permissionPopup.show=!1,t.nextStep()})):this.$checkPermissions().then((function(t){window.stream=t})).catch((function(e){console.error("[checkPermissions] allow error",e),t.$captureException(e),t.manageMicCamError(e,null,(function(){return this.exerciseStepBack(),!0}))})).finally((function(){t.$nuxt.$loading.finish(),t.$closeStream(),console.log("Close permission popup - web"),t.permissionPopup.show=!1,t.nextStep()}))},allowClick:function(){this.$closeStream(),console.log("pre",this.permissionPopup.show),this.permissionPopup.show=!0,console.log("post",this.permissionPopup.show)},closePermissionPopup:function(){this.grantAsked=!0,this.permissionPopup.show=!1,this.$analytics.logEvent("exercise_tutorial_quit",{id:this.getCurrentExercise.id,name:this.getCurrentExercise.title,program_id:this.getCurrentExercise.program_id||null,type:this.getCurrentExercise.type}),this.$analytics.logEvent("exercise_tutorial_nopermissions_quit",{id:this.getCurrentExercise.id,name:this.getCurrentExercise.title,program_id:this.getCurrentExercise.program_id||null,type:this.getCurrentExercise.type}),document.querySelector("#__nuxt")&&document.querySelector("#__nuxt").classList.add("quit"),this.exerciseStepBack()},nextPermissionPopup:function(){this.allowClickSecond()},exitStep:function(){this.$analytics.logEvent("exercise_tutorial_quit",{id:this.getCurrentExercise.id,name:this.getCurrentExercise.title,program_id:this.getCurrentExercise.program_id||null,type:this.getCurrentExercise.type}),document.querySelector("#__nuxt")&&document.querySelector("#__nuxt").classList.add("quit"),this.exerciseStepBack()},prevStep:function(){var t=this;if(this.video&&this.video.pause(),!0!==this.about.show)if(!0!==this.permissionPopup.show){if(this.$el.classList.add("back"),this.animate=!1,this.getCurrentExercise.type===$nuxt.$exerciseManager.kindHOLD&&this.step,3===this.step&&this.getCurrentExercise&&"dob"===this.getCurrentExercise.subtype&&(this.step=2),this.step<=0)return this.$analytics.logEvent("exercise_tutorial_"+this.step+"_quit",{id:this.getCurrentExercise.id,name:this.getCurrentExercise.title,program_id:this.getCurrentExercise.program_id||null,type:this.getCurrentExercise.type}),this.$analytics.logEvent("exercise_tutorial_quit",{id:this.getCurrentExercise.id,name:this.getCurrentExercise.title,program_id:this.getCurrentExercise.program_id||null,type:this.getCurrentExercise.type}),void this.exerciseStepBack();this.step-=0===this.step?0:1,this.$nextTick((function(){t.animate=!0,console.log("remove hide from video?",t.video),t.$forceNextTick((function(){Object(r.a)(t.$el.querySelectorAll(".hide")).map((function(t){return t.classList.remove("hide")}))}))}))}else this.closePermissionPopup();else this.closeInfo()},startExercise:function(){this.$analytics.logEvent("exercise_tutorial_finished",{id:this.getCurrentExercise.id,name:this.getCurrentExercise.title,program_id:this.getCurrentExercise.program_id||null,type:this.getCurrentExercise.type}),this.video?this.video.pause():Object(r.a)(document.querySelectorAll("video")).forEach((function(t){t.pause()}));var t=this.buildSuffix();t.length>0&&(t="/"+t),this.exercise.type===this.$exerciseManager.kindHOLD?this.$router.push($nuxt.localePath("/ml/exercises/"+this.exid+"/runnersilent"+t)):this.$router.push($nuxt.localePath("/ml/exercises/"+this.exid+"/runner"+t))},nextStep:function(){var t=this;return this.video&&this.video.pause(),this.$el&&this.$el.classList&&this.$el.classList.remove("back"),this.animate=!1,console.log("check steps",this.step,this.grantAsked),"hold"!==this.getCurrentExercise.type&&2!=this.step||!1!==this.grantAsked?(1===this.step&&this.getCurrentExercise&&"dob"===this.getCurrentExercise.subtype&&(this.step=2),console.log("Step:",this.step,this.hasVideoTutorial,this.exercise.type,this.stepLast),this.step>=this.stepLast&&!1===this.grantAsked&&0==this.hasVideoTutorial?(this.animate=!0,void this.allowClick()):(this.step+=1,this.step>=this.stepLast&&1==this.hasVideoTutorial?(console.log("checkif grantAsked"),this.hasNext=this.grantAsked):this.step>this.stepLast&&0==this.hasVideoTutorial&&(this.hasNext=this.grantAsked),this.$analytics.logEvent("exercise_tutorial_"+this.step,{id:this.getCurrentExercise.id,name:this.getCurrentExercise.title,program_id:this.getCurrentExercise.program_id||null,type:this.getCurrentExercise.type}),this.$analytics.setScreenName(this.getCurrentExercise.title+" "+this.getCurrentExercise.type+" Tutorial Step "+this.step),this.step===this.stepLast&&this.$root.$emit("setNextText",this.$t("generic.start_arrow")),this.step>this.stepLast&&this.startExercise(),void this.$nextTick((function(){t.initVideoEvents(),t.animate=!0})))):(console.log("load permissions popup"),this.animate=!0,void this.allowClick())},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx".replace(/[xy]/g,(function(t){var e;return e=16*Math.random()|0,("x"===t?e:3&e|8).toString(16)}))},_handleError:function(t){console.log("got error during video Stream",t),this.$root.$emit("showToast",$nuxt.$t("errors.toasts.cannot_reproduce_tutorial"),"error"),this.nextStep()},_handleLoaded:function(){var t=this;console.log("gestisci video carico!"),this.video.readyState>=2?(this.$nextTick((function(){t.fixVideoHeight(t.video.videoWidth,t.video.videoHeight)})),this.video.classList.remove("hide"),console.log("video loaded",this.step),this.step>1&&this.video&&this.video.play()):(this.$root.$emit("showToast",$nuxt.$t("errors.toasts.cannot_reproduce_tutorial"),"error"),this.nextStep())},_handleEnd:function(){this.nextStep()},initVideoEvents:function(){var t=this;this.video||!1===this.hasVideoTutorial||setTimeout((function(){console.log("check video item",document.querySelector("video.videoplayer")),t.video=document.querySelector("video.videoplayer"),t.video&&(t.$root.$emit("showToast",$nuxt.$t("errors.toasts.adjust_volume"),"info","mdi-volume-high"),t.video.addEventListener("error",t._handleError),t.video.addEventListener("loadeddata",t._handleLoaded),t.video.addEventListener("ended",t._handleEnd),t.video.load())}),200),this.step===this.stepLast&&!1!==this.hasVideoTutorial&&setTimeout((function(){t.video&&t.video.readyState>=2&&(console.log("request plya..."),t.video.load(),t.video.play())}),200)},trackExerciseOpening:function(){var t=this;return new Promise((function(e,i){try{t.$analytics.logEvent("exercise_tutorial_"+t.step,{id:t.getCurrentExercise.id,name:t.getCurrentExercise.title,program_id:t.getCurrentExercise.program_id||null,type:t.getCurrentExercise.type}),t.$analytics.setScreenName(t.getCurrentExercise.title+" "+t.getCurrentExercise.type+" Tutorial Step "+t.step)}catch(t){console.error("Errore in analytics:",t)}e(!0)}))},innerStart:function(){var t=this;console.log("start tutorial:",this.getCurrentExercise),this.$nextTick((function(){t.$root.$emit("setNextText",t.$t("generic.next")),t.$root.$emit("disableNext",!1),t.trackExerciseOpening().then((function(t){})).finally((function(){t.loading=!0}))}))},handleBack:function(){this.prevStep()},disableSwipeEvent:function(){console.log("disable tutorial Swipe"),this.$root.$off("swipe",this.swipeEvent)},swipeEvent:function(t){this.permissionPopup.show||(console.log("LISTEN some one is swiping",t.target,t.detail),t.detail&&t.detail.dir&&("right"===t.detail.dir&&this.handleBack(),"left"===t.detail.dir&&this.nextStep()))}}),mounted:function(){var t=this;this.$root.$on("swipe",this.swipeEvent),this.$capacitor&&this.$capacitor.isNativePlatform()&&(this.$backEmitter.callback=this.handleBack),this.stepBreak=0,this.getCurrentExercise&&this.getCurrentExercise.tutorialVideo&&(this.getCurrentExercise.tutorialVideo+"").length>0&&(this.uuid=this.generateUUID(),this.hasVideoTutorial=this.getCurrentExercise.tutorialVideo),this.skipPermissions,this.stepLast=!1!==this.hasVideoTutorial?3:2,this.getCurrentExercise&&"hold"===this.getCurrentExercise.type&&(this.stepLast=!1!==this.hasVideoTutorial?1:0),this.$capacitor.isNativePlatform()?this.$airlyn.checkWholePermissions().then((function(e){console.log("got whole permission check result",e);var i=["granted",!0],r=!1;["storage","voice recording"].map((function(t){r=-1!==i.indexOf(e[t])})),console.log("checked permissions",r),t.skipPermissions=r,t.grantAsked=r})).finally((function(){t.innerStart()})):this.innerStart()},beforeDestroy:function(){this.video&&(this.video.removeEventListener("loadeddata",this._handleLoaded),this.video.removeEventListener("error",this._handleError),this.video.removeEventListener("ended",this._handleEnd)),this.disableSwipeEvent()}},u=i(42),h=Object(u.a)(l,(function(){var t=this,e=t._self._c;return t.animate&&t.loading?e("fullpage-card",{class:[t.needsToShowHeader,"setupPage","with-tutorial"],attrs:{"data-swipe-enable":"true",hidefooter:!0},scopedSlots:t._u([t.step!=t.stepBreak?{key:"header",fn:function(){return[e("v-row",{staticClass:"navigation",attrs:{"align-content":"center",justify:"space-between"}},[e("v-btn",{attrs:{icon:""},on:{click:t.exitStep}},[e("v-icon",[t._v("mdi-close-circle-outline")])],1),t._v(" "),t.getCurrentExercise?e("div",{staticClass:"exercise__title"},[e("span",[t._v(t._s(t.$t("setup.title")))])]):t._e(),t._v(" "),e("v-btn",{staticStyle:{opacity:"0"},attrs:{icon:""}},[e("v-icon",[t._v("mdi-information-outline")])],1)],1),t._v(" "),t.step>t.stepBreak&&(t.step<t.stepLast||0==t.hasVideoTutorial&&t.step<=t.stepLast)?e("div",{staticClass:"text-center"},[e("div",{domProps:{innerHTML:t._s(t.getTutorialTitle(t.name,t.step))}})]):t._e()]},proxy:!0}:null,{key:"body",fn:function(){return[e("transition",{attrs:{appear:"",name:"fade"}},[t.step>t.stepBreak&&(t.step<t.stepLast||0==t.hasVideoTutorial&&t.step<=t.stepLast)?e("v-flex",{staticClass:"text-center exercise__body",attrs:{"align-self-center":""}},[e("img",{attrs:{src:t.getTutorialImage(t.name,t.step)}}),t._v(" "),e("p",{staticClass:"pt-10",domProps:{innerHTML:t._s(t.getTutorialText(t.name,t.step))}}),t._v(" "),e("div",{staticClass:"skip_tutorial"},[e("v-btn",{staticClass:"skip--btn",attrs:{plain:"",text:""},on:{click:t.skipAll}},[t._v(t._s(t.$t("generic.skiptutorial"))+"\n            "),e("v-icon",[t._v("$skip")])],1)],1)]):t._e(),t._v(" "),t.step>=t.stepLast&&!1!==t.hasVideoTutorial?e("div",{staticClass:"playerArea video tutorial",attrs:{id:"playerAreaTutorial"}},[e("video",{ref:"videofile",class:["videoplayer",t.video&&t.video.readyState>=2?"":"hide"],attrs:{id:t.playerId,loop:!1,controls:"",playsinline:"",poster:t.getCurrentExercise.tutorialVideoThumbnail?t.getCurrentExercise.tutorialVideoThumbnail:"",src:t.hasVideoTutorial,preload:"auto"}})]):t._e(),t._v(" "),t.step==t.stepBreak?e("div",{staticClass:"tutorial_info"},[e("div",{staticClass:"tutorial__header header"},[e("div",{staticClass:"header_wrapper"},t._l(t.getCurrentExercise.steps,(function(i,r){return i.showInTutorial?e("div",{key:"tstep_"+r},[e("div",{staticClass:"step_title"},[t._v(t._s(i.mainText||" "))]),t._v(" "),i.image?e("div",{staticClass:"step_image"},[e("v-img",{attrs:{src:i.image||"","max-width":"90","max-height":"90"}})],1):t._e(),t._v(" "),i.duration>0&&!i.hold?e("div",{staticClass:"step_time"},[t._v(t._s(i.duration)),e("span",[t._v("s")])]):t._e()]):t._e()})),0),t._v(" "),"dob"!=t.getCurrentExercise.subtype&&"voice"!=t.getCurrentExercise.subtype?e("div",{staticClass:"header_cycles"},[e("v-icon",[t._v("mdi-sync")]),t._v(" "+t._s(t.getCurrentExercise.cycles)+" "+t._s(t.$nuxt.$t("setup.cycles"))+"\n          ")],1):t._e()]),t._v(" "),e("div",{staticClass:"tutorial__body body"},[e("div",{staticClass:"tutorial__title"},[t._v(t._s(t.getCurrentExercise.title))]),t._v(" "),t.getCurrentExercise.duration&&t.getCurrentExercise.duration>0?e("div",{staticClass:"tutorial_exinfo"},[e("v-icon",[t._v("mdi-clock-time-four-outline")]),t._v(" \n            "+t._s(t.$humanizeTime(t.getCurrentExercise.duration))+"\n          ")],1):t._e(),t._v(" "),t.getCurrentExercise.medicalRisks&&t.getCurrentExercise.medicalRisks.length>0?e("div",{staticClass:"tutorial__medicalrisks",on:{click:t.openMedicalRisks}},[e("v-icon",{staticClass:"warn"},[t._v("$custom_warning")]),t._v(" "),e("div",{staticClass:"tutorial__medicalrisks__content"},[t._v(t._s(t.$t("setup.onlyproceedwithdoctorok")))]),t._v(" "),e("v-icon",[t._v("mdi-chevron-right")])],1):t._e(),t._v(" "),e("v-divider",{staticClass:"tutorial__divider"}),t._v(" "),e("div",{staticClass:"tutorial__content",domProps:{innerHTML:t._s(t.getCurrentExercise.about||"")}})],1)]):t._e()],1),t._v(" "),t.getCurrentExercise?e("infodialog",{attrs:{show:t.about.show,contentclasses:"infoContent",title:t.getCurrentExercise.title,description:t.getCurrentExercise.about||"",infoImage:t.getCurrentExercise.aboutImage||t.getCurrentExercise.thumbnail},on:{close:t.closeInfo},scopedSlots:t._u([{key:"closebtn",fn:function(){return[t._v("Alright")]},proxy:!0}],null,!1,2600066686)}):t._e(),t._v(" "),e("permissionpopup",{attrs:{show:t.permissionPopup.show},on:{close:t.closePermissionPopup,next:t.nextPermissionPopup}}),t._v(" "),t.getCurrentExercise?e("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"slide-x-reverse-transition-slow","content-class":"customDialog medicalRisks",scrollable:""},model:{value:t.medicalrisks.show,callback:function(e){t.$set(t.medicalrisks,"show",e)},expression:"medicalrisks.show"}},[e("fullpage-card",{attrs:{hidefooter:!0},scopedSlots:t._u([{key:"header",fn:function(){return[e("v-btn",{staticClass:"closebtn",attrs:{icon:""},on:{click:t.closeMdRisks}},[e("v-icon",[t._v("mdi-chevron-left")])],1),t._v(" "),e("div",{class:["without__supertitle","without__thumbInTitle"]},[e("div",{staticClass:"text-center infodialog__title"},[t._v(t._s(t.$t("setup.always_remember")))])]),t._v(" "),e("v-btn",{staticClass:"closebtn",staticStyle:{opacity:"0"},attrs:{icon:""},on:{click:t.closeMdRisks}},[e("v-icon",[t._v("mdi-close-circle-outline")])],1)]},proxy:!0},{key:"body",fn:function(){return[e("div",{staticClass:"text-center content"},[e("div",{staticClass:"infoContent",domProps:{innerHTML:t._s(t.getCurrentExercise.medicalRisks||"")}})])]},proxy:!0}],null,!1,2606847367)})],1):t._e()]},proxy:!0}],null,!0)}):t._e()}),[],!1,null,null,null);e.default=h.exports;installComponents(h,{Infodialog:i(924).default,Permissionpopup:i(512).default,FullpageCard:i(219).default})}}]);
//# sourceMappingURL=b050ef5.js.map