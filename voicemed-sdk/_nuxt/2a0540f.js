(window.webpackJsonp=window.webpackJsonp||[]).push([[19,5,7],{923:function(t,e,i){"use strict";i(5),i(7),i(8),i(9);var n=i(179),r=i(24),o=i(26),s=(i(98),i(0),i(28),i(62),i(63),i(27),i(37),i(221),i(10),i(6),i(220),i(112),i(3),i(46));function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){Object(o.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}e.a={name:"basePage",transition:{name:"slide",mode:"out-in",css:!1,beforeEnter:function(t){if(!document.querySelector("#__nuxt").classList.contains("quit")){var e=document.querySelector("#__nuxt").classList.contains("back")?"-100%":"100%";this.$anime.set(t,{scale:1,opacity:0,translateX:e})}},enter:function(t,e){var i=document.querySelector("#__nuxt").classList.contains("back")?"-100%":"100%";this.$anime({targets:t,opacity:[0,1],translateX:[i,"0"],duration:500,easing:"easeInOutSine",complete:e})},leave:function(t,e){if(document.querySelector("#__nuxt").classList.contains("quit"))this.$anime({targets:t,translateY:[0,"100%"],duration:500,easing:"easeInOutSine",complete:e});else{var i=document.querySelector("#__nuxt").classList.contains("back")?"100%":"-100%";this.$anime({targets:t,opacity:[1,0],translateX:["0",i],duration:500,easing:"easeInOutSine",complete:e})}},afterLeave:function(t){document.querySelector("#__nuxt").classList.remove("quit"),document.querySelector("#__nuxt").classList.remove("back")}},data:function(){return{name:"basePage",exid:this.$route.params.id,programid:this.$route.params.fromprogram||!1,withindex:this.$route.params.withindex||-1,backto:this.$route.params.backto||!1,hasBack:!1,hasNext:!1,hasInfo:!1,currentTutorial:!1,tutorialList:[],tutorialShownHard:!1}},computed:u(u({},Object(s.d)({getCurrentPagerHeight:"getCurrentPagerHeight",getTutorialShown:"getTutorialShown",getLocalTutorialShown:"getLocalTutorialShown"})),{},{isVoicemed:function(){return $nuxt.$config.env.environment.indexOf("voicemed_")>-1},isAirlyn:function(){return $nuxt.$config.env.environment.indexOf("voicemed_")<0},nuxtloading:function(){return $nuxt.$loading.loading},defaultHomeUrl:function(){return"/user/today"}}),methods:u(u({},Object(s.c)({setCurrentPage:"setCurrentPage",setCurrentPagerHeight:"setCurrentPagerHeight",setTutorialRunPerPage:"setTutorialRunPerPage",setTutorialRun:"setTutorialRun"})),{},{setTutorialRunLocal:function(){this.setPreferenceTutorial()},tutorialClose:function(){this.$set(this,"tutorialList",[]),this.setTutorialRunLocal(),this.currentTutorial=null},tutorialHasNext:function(){var t=this.currentTutorial.index;return!!this.tutorialList.find((function(e){return e.index===t+1}))},exerciseStepBack:function(){console.log("exit test",this.backto,this.programid),"standalone"!=this.backto?"today"!=this.backto?"discovery"!=this.backto?this.programid?"-1"==this.programid||-1==this.programid||"false"==this.programid||0==this.programid?$nuxt.$router.replace($nuxt.localePath("/user/today")):$nuxt.$router.replace($nuxt.localePath("/ml/programs/"+this.programid)):$nuxt.$router.replace($nuxt.localePath("/user/today")):$nuxt.$router.replace($nuxt.localePath("/home")):$nuxt.$router.replace($nuxt.localePath("/user/today")):$nuxt.$airlyn.finishExercise({reason:"user-cancelled",result:{}}).finally((function(){console.log("exercise finished by user")}))},buildSuffix:function(){var t=[],e=!!this.programid&&this.programid;return t.push("-1"!==e&&e),t.push(this.withindex?this.withindex:"-1"),t.push(!!this.backto&&this.backto),t.join("/")},tutorialNext:function(){var t=this.currentTutorial?this.currentTutorial.index:0;this.currentTutorial?(this.currentTutorial.visible=!1,this.setTutorialRunLocal()):t=this.tutorialList[0].index-1;var e=this.tutorialList.find((function(e){return e.index===t+1}));if(e){this.currentTutorial=e;e.position.height;var i=e.position.top>this.appHeight/2?e.position.top-210:e.position.top-10;e.arrowTop&&(i=e.position.top-(e.position.height+10)),i=Math.max(0,i),console.warn("Nuovo scroll Top:",i,this.appHeight,this.footerHeight,e.position.height),this.$nextTick((function(){document.querySelector(".indexPage").scrollTo({top:i,left:0,behavior:"smooth"})})),e.visible=!0}else this.tutorialClose()},getTutorialIndex:function(){return this.currentTutorial?this.currentTutorial.index>this.tutorialList.length?this.tutorialList.length:this.currentTutorial.index:""},getTutorialText:function(t){return this.$t("tutorials."+this.name+".text_"+t.index,{title:t.title})},getTutorialDialogStyle:function(t){var e={},i=t.position,n=i.top;return this.$capacitor&&this.$capacitor.isNativePlatform()&&0==t.updated&&(n=i.top,t.updated=!0,console.warn("apply tutorial offset for mobile phones")),e.top=n>300?n-200+"px":n+i.height+10+"px",console.warn("DialogStyle for tutorial",t,e),"fill"!==t.width?e.left="calc("+i.left+"px - 75vw + "+i.width+"px )":(e.left="0px",e.right="0px"),Object.entries(e).map((function(t){var e=Object(r.a)(t,2),i=e[0],n=e[1];return"".concat(i,":").concat(n)})).join(";")},getTutorialStyle:function(t){var e={},i=t.position,n=i.top;return this.$capacitor&&this.$capacitor.isNativePlatform()&&0==t.updated&&(n=i.top,t.updated=!0),console.warn("Style for tutorial",t,n),"fill"===t.width?(e.top=n-4+"px",e.left="0px",e.right="0px",e.height=i.height+8+"px"):(e.top=n-4+"px",e.left=i.left-4+"px",e.right="0px",e.height=i.height+8+"px",e.width=i.width+8+"px"),Object.entries(e).map((function(t){var e=Object(r.a)(t,2),i=e[0],n=e[1];return"".concat(i,":").concat(n)})).join(";")},initTutorial:function(){var t=this,e=Object(n.a)(document.querySelectorAll(".hastutorial")),i=!1;if(this.$capacitor&&this.$capacitor.isNativePlatform()?i=this.tutorialShownHard:(this.tutorialShownHard=this.$nuxt.$store.getters.getTutorialRun(this.name),i=this.$nuxt.$store.getters.getTutorialRunPerPage(this.name)),void 0!==this.getTutorialShown[this.name]||i||this.tutorialShownHard)console.warn("hide tutorial, not needed at this round");else{if(this.$set(this,"tutorialList",[]),e.length>0){document.querySelector(".indexPage").scrollTo({top:0,left:0,behavior:"smooth"});var r=this.getLocalTutorialShown;console.warn("got local tutorials",r),e.forEach((function(e){var i=parseInt(e.dataset.tutorialindex);if(void 0===r[t.name+"_"+i]){var n=e.getBoundingClientRect();t.tutorialList.push({position:n,visible:!1,itemRef:e,updated:!1,arrowTop:"top"==e.dataset.tutorialarrow,title:e.dataset.tutorial,width:e.dataset.tutorialwidth,index:i})}})),window.tutorialList=this.tutorialList}this.tutorialList.length>0&&(this.tutorialList=this.tutorialList.sort((function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}))),this.tutorialList.length>0&&(this.currentTutorial=0,this.$nextTick((function(){setTimeout((function(){t.tutorialList.forEach((function(t){t.position=t.itemRef.getBoundingClientRect()})),t.tutorialNext(),t.setTutorialRunPerPage(t.name)}),200)})))}},hasJoinedProgramById:function(t){return this.$nuxt.$store.getters.hasJoinedProgramById(t)},getProgramJoinedAtById:function(t){return this.$nuxt.$store.getters.getProgramJoinedAtById(t)},getProgramById:function(t){return this.$nuxt.$store.getters.getProgramById(t)},getOverallProgressProgramById:function(t){return this.$nuxt.$store.getters.getOverallProgressProgramById(t)},getDoneCountByProgramId:function(t){return this.$nuxt.$store.getters.getDoneCountByProgramId(t)},getNextExerciseByProgramId:function(t){return this.$nuxt.$store.getters.getNextExerciseByProgramId(t)},getExercisetocompleteCountProgramById:function(t){return this.$nuxt.$store.getters.getExercisetocompleteCountProgramById(t)},getExercisecompletedCountProgramById:function(t){return this.$nuxt.$store.getters.getExercisecompletedCountProgramById(t)},printDeviceError:function(t,e,i,n){this.$analytics.logEvent("permission_error",{title:"errors."+t+"."+e.name.toLowerCase()+".title",kind:t}),console.error("Got device error",e),!e||"NotAllowedError"!==e.name&&"NotFoundError"!==e.name&&"denied"!=e.exception.state&&"DENIED"!=e.exception.state?this.showError(this.$t("errors.generic.title"),this.$t("errors.generic.description"),i,n):this.$root.$emit("showPermssionError",!0)},printDeviceErrorOLD:function(t,e,i,n){if(this.$analytics.logEvent("permission_error",{title:"errors."+t+"."+e.name.toLowerCase()+".title",kind:t}),console.error("Got device error",e),e.exception&&"mic"==t&&("denied"==e.exception.state||"DENIED"==e.exception.state))return e.name="DeniedError",void this.$root.$emit("showError",{title:this.$t("errors."+t+"."+e.name.toLowerCase()+".title"),error:this.$t("errors."+t+"."+e.name.toLowerCase()+".description"),hasretry:!0,click:function(){return $nuxt.$airlyn.openPermissionPanel().then((function(t){console.log("got openPermission Panel then",t,JSON.stringify(t))})).catch((function(t){console.log("got openPermission Panel catch",t,JSON.stringify(t))})).finally((function(){"function"==typeof n&&(console.log("dopo il setting riport cmq a inizio"),n())})),!0},resetEvent:n||function(){},retryBtn:"Settings"});!e||"NotAllowedError"!==e.name&&"NotFoundError"!==e.name?this.showError(this.$t("errors.generic.title"),this.$t("errors.generic.description"),i,n):this.showError(this.$t("errors."+t+"."+e.name.toLowerCase()+".title"),this.$t("errors."+t+"."+e.name.toLowerCase()+".description"),i,n)},manageMicError:function(t,e,i){this.printDeviceError("mic",t,e,i)},manageCamError:function(t,e,i){this.printDeviceError("cam",t,e,i)},manageMicCamError:function(t,e,i){this.printDeviceError("miccam",t,e,i)},showError:function(t,e,i,n){this.$root.$emit("showError",{title:t,error:e,hasretry:null!==i,click:i||function(){},resetEvent:n||function(){}})},swipeEvent:function(t){this.$root.$emit("swipe",t)},attachSwipeListener:function(){document.addEventListener("swiped-left",this.swipeEvent),document.addEventListener("swiped-right",this.swipeEvent)},detachSwipeListeners:function(){document.removeEventListener("swiped-left",this.swipeEvent),document.removeEventListener("swiped-right",this.swipeEvent)},retrievePreferenceTutorial:function(){var t=this;this.$capacitor&&this.$capacitor.isNativePlatform()&&this.$airlyn.preferenceConfigure({group:"airlyn"}).finally((function(){console.log("preferences ready");var e="tutorial_"+t.name;t.$airlyn.preferenceGet({key:e}).then((function(i){console.log("preference read ("+e+")!",i),i&&i.value&&(1===i.value||"1"==i.value)&&(console.log("got preference Tutorial SEEN for",e,i.value),t.tutorialShownHard=!0)}))}))},setPreferenceTutorial:function(){if(this.$capacitor&&this.$capacitor.isNativePlatform()){var t="tutorial_"+this.name;this.$airlyn.preferenceSet({key:t,value:"1"}).finally((function(){console.log("preference stored for!",t)}))}this.setTutorialRun({page:this.name,index:this.currentTutorial.index}),this.tutorialShownHard=!0}}),beforeMount:function(){console.log("PRE loaded base Page"),this.setCurrentPage(this)},beforeDestroy:function(){this.detachSwipeListeners()},mounted:function(){var t=this;console.log("loaded base Page"),this.tutorialShownHard=!1,this.retrievePreferenceTutorial(),console.log("try Load index",this.name,this.dynamicTexts),this.dynamicTexts&&Object.keys(this.dynamicTexts).length>0&&Object.keys(this.dynamicTexts).map((function(e){t.$appConfiguration.getText(e).then((function(i){t.dynamicTexts[e]=i})).catch((function(i){t.dynamicTexts[e]=t.$t(t.name+"."+e)}))})),null!==this.getCurrentPagerHeight&&document.querySelector(".v-main__wrap > div.pager")&&(document.querySelector(".v-main__wrap > div.pager").style.height=this.getCurrentPagerHeight+"px"),this.$nextTick((function(){if(t.$capacitor&&t.$capacitor.isNativePlatform())console.log("Richiesto al passaggio precedente");else{var e=t.getLocalTutorialShown;e&&void 0!==e[t.name]?t.tutorialShownHard=!0:t.tutorialShownHard=!1}t.attachSwipeListener(),null===t.getCurrentPagerHeight&&document.querySelector(".v-main__wrap > div.pager")&&t.setCurrentPagerHeight(Math.max(document.querySelector(".v-main__wrap > div.pager").clientHeight,document.querySelector(".v-main__wrap > div.pager").offsetHeight))}))}}},926:function(t,e,i){"use strict";i.r(e);i(314);var n="abort",r="progress",o="start",s="visibilitychange",a={name:"CountDown",props:{interval:{type:Number,default:1e3},timerLength:{type:Number,default:1e4},reverse:{type:Boolean,default:!1},now:{type:Function,default:function(){return Date.now()}},emits:{EVENT_ABORT:n,EVENT_END:"end",EVENT_PROGRESS:r,EVENT_START:o}},data:function(){return{counting:!1,totalMilliseconds:0,requestId:0,endTime:0,elapsed:0}},computed:{totalSeconds:function(){return Math.floor(this.totalMilliseconds/1e3)}},watch:{$props:{deep:!0,immediate:!0,handler:function(){this.totalMilliseconds=this.timerLength,this.endTime=this.now()+this.timerLength}}},mounted:function(){document.addEventListener(s,this.handleVisibilityChange)},beforeUnmount:function(){document.removeEventListener(s,this.handleVisibilityChange),this.pause()},methods:{restart:function(){this.totalMilliseconds=this.timerLength,this.endTime=this.now()+this.timerLength,this.elapsed=0,this.start()},start:function(){this.counting||(this.counting=!0,this.$emit(o),"visible"===document.visibilityState&&this.continue())},getElapsed:function(){return this.elapsed},continue:function(){var t=this;if(this.counting){var e=Math.min(this.totalMilliseconds,this.interval);if(e>0){var i,n;this.requestId=requestAnimationFrame((function r(o){i||(i=o),n||(n=o);var s=o-i;s>=e||s+(o-n)/2>=e?t.progress():t.requestId=requestAnimationFrame(r),n=o}))}else this.end()}},pause:function(){cancelAnimationFrame(this.requestId)},progress:function(){this.counting&&(this.totalMilliseconds-=this.interval,this.elapsed+=this.interval,this.totalMilliseconds>0&&this.$emit(r,{totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds,interval:this.interval,elapsed:this.elapsed}),this.continue())},abort:function(){this.counting&&(this.pause(),this.counting=!1,this.$emit(n))},end:function(){this.counting&&(this.pause(),this.counting=!1,this.$emit("end",{totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds,interval:this.interval,elapsed:this.elapsed}),this.totalMilliseconds=0)},update:function(){this.counting&&(this.totalMilliseconds=Math.max(0,this.endTime-this.now()))},handleVisibilityChange:function(){switch(document.visibilityState){case"visible":this.update(),this.continue();break;case"hidden":this.pause()}}}},u=i(42),c=Object(u.a)(a,(function(){return(0,this._self._c)("div",{staticClass:"countdown_wrapper"})}),[],!1,null,null,null);e.default=c.exports},927:function(t,e,i){"use strict";i.r(e);i(314);var n={props:{value:{type:Number,default:0},exerciseSteps:{type:Number,default:1},startPercent:{type:Number,default:0},doneClass:{type:String,default:"done"},maxPercent:{type:Number,default:1},runningPercent:{type:Number,default:0}},computed:{primaryColor:function(){return $nuxt.$config.env.environment.indexOf("voicemed_")>-1?"#EC483F":"#848CE6"},exercisescount:function(){return this.exerciseSteps},currentExercise:function(){return this.value},currentPercent:function(){return this.runningPercent}},methods:{getRotation:function(t){return 0===t?"transform:rotate(0deg);":"transform:rotate("+360/this.exercisescount*t+"deg);"}}},r=i(42),o=Object(r.a)(n,(function(){var t=this,e=t._self._c;return e("div",{class:["donut_progress"]},[e("vc-donut",{attrs:{background:"#FFFFFF",foreground:"#848CE633",size:100,unit:"%",thickness:5,sections:[{label:"progress",value:t.currentPercent,color:t.primaryColor}],total:100,"start-angle":0,"auto-adjust-text-size":!0}},[t._t("inside")],2)],1)}),[],!1,null,null,null);e.default=o.exports},962:function(t,i,n){"use strict";n.r(i);n(3),n(5),n(7),n(8),n(6),n(9);var r=n(26),o=(n(27),n(28),n(62),n(0),n(37),n(112),n(63),n(923)),s=n(926),a=n(46);function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){Object(r.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var l={name:"ml_start",mixins:[o.a],components:{CountDownItem:s.default},beforeRouteLeave:function(t,e,i){document.querySelector(".nextvm").classList.remove("pumpAnimation"),this.$closeStream(),i()},data:function(){return{audioLevels:{peakLevel:0,averageLevel:0},audioInput:{},exid:this.$route.params.id,programid:this.$route.params.fromprogram||!1,withindex:this.$route.params.withindex||!1,backto:this.$route.params.backto||!1,name:"ml_start",deviceInfo:"",hasBack:!0,hasNext:!0,timer:0,countdownrunning:!1,startTimer:!1,audio:{audioContext:null,audioInput:null,realAudioInput:null,inputPoint:null,audioRecorder:null,stereo:!1},bottomsheet:{show:!1},uploadProgress:0,passed:!1,hasWarning:!1,errorMessage:"",loading:!1,finish:!1,intervals:[]}},computed:c(c({},Object(a.d)({getExercises:"getExercises",getCurrentExercise:"getCurrentExercise",getAudioDevices:"getAudioDevices"})),{},{exercise:function(){return this.getCurrentExercise},currentUploadProgress:function(){var t=100*this.uploadProgress;return t>100?100:t},currentPercent:function(){var t=this.timer/this.timerLength*100*75/100+25*this.currentUploadProgress/100;return t>100?100:t},timerLength:function(){return 5},timerRest:function(){return 5-this.timer},getTitle:function(){return this.$t(this.name+".title").replace("%s",this.timer)}}),methods:{exitStep:function(){document.querySelector("#__nuxt")&&document.querySelector("#__nuxt").classList.add("quit"),this.exerciseStepBack()},retryNoise:function(){return this.bottomsheet.show=!1,this.setupAll(),!0},leaveMe:function(){var t=this;this.$refs.noisecountdown.abort(),this.$capacitor.isNativePlatform()?(this.$nuxt.$loading.start(),$nuxt.$airlyn.removeAllListeners(),this.$airlyn.stopRecording().finally((function(){t.$nuxt.$loading.finish(),document.querySelector("#__nuxt")&&document.querySelector("#__nuxt").classList.add("quit"),t.$router.push($nuxt.localePath("/ml/exercises/"+t.exid))}))):(this.$closeStream(),this.audio&&this.audio.audioRecorder&&this.audio.audioRecorder.stop(),document.querySelector("#__nuxt")&&document.querySelector("#__nuxt").classList.add("quit"),this.$router.push($nuxt.localePath("/ml/exercises/"+this.exid)))},prevStep:function(){var t=this;this.intervals.map((function(t){try{clearTimeout(t)}catch(t){}})),this.$refs.noisecountdown.abort(),this.$capacitor.isNativePlatform()?(this.$nuxt.$loading.start(),this.$airlyn.stopRecording().finally((function(){t.$nuxt.$loading.finish(),t.$router.back()}))):(this.$closeStream(),this.audio&&this.audio.audioRecorder&&this.audio.audioRecorder.stop(),this.$router.back())},nextStep:function(){var t=this.buildSuffix();t.length>0&&(t="/"+t),this.exercise.type===this.$exerciseManager.kindHOLD?this.$router.push($nuxt.localePath("/ml/exercises/"+this.exid+"/runnersilent"+t)):this.$router.push($nuxt.localePath("/ml/exercises/"+this.exid+"/runner"+t))},sendDataToRest:function(t){var e=this;this.passed=!1,this.loading=!0,this.$nuxt.$loading.start();var i=new Date,n=this.$auth.user?this.$auth.user._id||this.$auth.user.userId:i.getMilliseconds(),r=new File([t],"soundcheck_"+n+".wav",{type:"audio/x-wav",lastModified:Date.now()}),o=new FormData;o.append("audio",r,r.name),o.append("device_code",this.deviceInfo),this.audioInput&&o.append("device_info",JSON.stringify(this.audioInput));var s={Authorization:this.$auth.strategy.token.get(),timeout:this.$exerciseManager.longTaskTimeout,onUploadProgress:function(t){e.uploadProgress=t.loaded/t.total}};this.$axios.$post($nuxt.$apiConstants.preNoiseCheck_v2,o,s).then((function(t){console.log("noiseCheck result",t),e.uploadProgress=1,e.passed=!1,e.hasWarning=!1,e.errorMessage="";var i="",n="";t&&t.resultCode?t.resultCode>310?e.passed=!0:t.resultCode>307?(e.passed=!0,e.hasWarning=!0,e.errorMessage=t.message||e.$t("errors.noise.description")):(e.passed=!1,i=e.$t("errors.noise.title"),e.errorMessage=t.message||e.$t("errors.noise.description")):(e.passed=!1,i=e.$t("errors.noise.title"),n=e.$t("errors.noise.description")),!1===e.passed&&e.$root.$emit("showError",{hasretry:!0,title:i,error:n,leaveBtn:e.$t("generic.startanyway"),click:function(){return e.setupAll(),e.$gtag("event","click",{event_label:"NoiseReCheck",event_category:"Exercises"}),!0},resetEvent:function(){return e.passed=!0,e.$gtag("event","click",{event_label:"NoiseStartAnyWay",event_category:"Exercises"}),e.bottomsheet.show=!0,!0}})})).catch((function(t){console.log("noiseCheck error",t),console.error("Errore invio api [pre_noise_check]:",t),e.$analytics.logEvent("error",{title:"noise check error"}),e.$captureException(t),e.$root.$emit("showError",{hasretry:!1,title:"An error has occurred",error:"Sorry an issue with the VoiceServer has occurred",click:function(){return e.setupAll(),e.$gtag("event","click",{event_label:"NoiseReCheck",event_category:"Exercises"}),!0},resetEvent:function(){return e.passed=!0,e.$gtag("event","click",{event_label:"NoiseStartAnyWay",event_category:"Exercises"}),e.bottomsheet.show=!0,!0}})})).finally((function(){e.passed&&(e.$root.$emit("disableNext",!1),e.$nextTick((function(){document.querySelector(".nextvm").classList.add("pumpAnimation")}))),e.loading=!1,e.finish=!0,e.$nuxt.$loading.finish()}))},gotData:function(t){var e=this;console.log("got buffers"),this.$nuxt.$loading.finish(),this.audio.audioRecorder.exportMonoWAV((function(t){e.$closeStream(),e.sendDataToRest(t)}))},gotDataNative:function(t,e){console.log("ready to store file for sending...",e);var i=this.$base64ToBlob(t,e);this.sendDataToRest(i)},stopRecording:function(){var t=this;this.$nuxt.$loading.start(),this.loading=!0,this.$capacitor.isNativePlatform()?(console.log("request stop recording!"),this.$airlyn.removeAllListeners(),this.$airlyn.stopRecording().then((function(i){i&&i.value?t.gotDataNative(i.value.recordDataBase64,i.value.mimeType):(console.error("(catch)Errore stop :",e),t.manageMicError({name:"Cannot retrieve Recording",error:e},null,(function(){return this.exitStep(),!0})))})).catch((function(e){console.error("(catch)Errore stop :",e),t.manageMicError({name:"Cannot retrieve Recording",error:e},null,(function(){return this.exitStep(),!0}))})).finally((function(){t.$nuxt.$loading.finish()}))):(console.log("request stop web"),this.audio.audioRecorder.stop(),console.log("retrieve buffers"),this.audio.audioRecorder.getBuffers(this.gotData))},timerChange:function(t){this.timer=this.timerLength-t.totalSeconds},timerEnd:function(){console.log("timer finito, ",this.timer),this.countdownrunning=!1,this.loading=!0,this.stopRecording()},countDownTimer:function(){var t=this;!1!==this.countdownrunning||this.intervals.push(setTimeout((function(){t.$nextTick((function(){console.log("avvia tutto"),t.countdownrunning=!0,console.log(t.$refs),t.$refs.noisecountdown.restart()}))}),1e3))},initCountDown:function(){this.timer=0,this.uploadProgress=0,this.countdownrunning=!1,this.startTimer=!0,this.audio.audioRecorder.clear(),this.audio.audioRecorder.record(),this.countDownTimer()},initCountDownNative:function(){var t=this;this.timer=0,this.uploadProgress=0,this.countdownrunning=!1,this.startTimer=!0,$nuxt.$airlyn.addListener("airlynUpdateMeters",(function(e){e&&(e.peakPower&&(t.audioLevels.peakLevel=e.peakPower),e.averagePower&&(t.audioLevels.averageLevel=e.averagePower))})),$nuxt.$airlyn.addListener("airlynUpdateMic",(function(e){console.log("got mic INFO",e),t.audioInput=e})),this.$airlyn.startRecording({useAGC:!0}).then((function(e){console.log("start recording...",e),e&&!0===e.value?t.countDownTimer():(console.error("(then)Errore start :",e),t.manageMicError({name:"Cannot start Recording"},null,(function(){return this.exitStep(),!0})))})).catch((function(e){console.error("(catch)Errore start :",e),t.manageMicError({name:"Cannot start Recording",error:e},null,(function(){return this.exitStep(),!0}))}))},initMicrophone:function(t){this.audio.inputPoint=this.audio.audioContext.createGain(),this.audio.realAudioInput=this.audio.audioContext.createMediaStreamSource(t),this.audio.audioInput=this.audio.realAudioInput,this.audio.audioInput.connect(this.audio.inputPoint),this.audio.realAudioInput.disconnect(),this.audio.audioInput=this.convertToMono(this.audio.realAudioInput),this.audio.audioInput.connect(this.audio.inputPoint),this.audio.audioRecorder=new this.$Recorder(this.audio.inputPoint,{worker:this.$worker.createRecorderWorker()}),this.initCountDown()},convertToMono:function(t){var e=this.audio.audioContext.createChannelSplitter(2),i=this.audio.audioContext.createChannelMerger(2);return t.connect(e),e.connect(i,0,0),e.connect(i,0,1),i},setupAll:function(){var t=this;if(this.loading=!1,this.finish=!1,this.$closeStream(),this.$capacitor.isNativePlatform())this.timer=0,this.countdownrunning=!1,this.initCountDownNative();else{var e=[];console.log(JSON.stringify(this.getAudioDevices)),console.log(navigator.mediaDevices.getSupportedConstraints()),e.push("Ready to record Audio"),e.push(JSON.stringify(this.getAudioDevices)),e.push("Supported Constraints:"),e.push(JSON.stringify(navigator.mediaDevices.getSupportedConstraints())),null==this.audio.audioContext&&(this.audio.audioContext=new AudioContext),this.$captureMessage(e.join("\n ")),this.$enumerateMediaDevices().then((function(e){return console.log("got devices",e),t.$initAudio(e).then((function(e){console.log(e),window.stream=e,null==t.audio.audioContext&&(t.audio.audioContext=new AudioContext),t.timer=0,t.countdownrunning=!1,t.initMicrophone(e)}))})).catch((function(e){console.error("errore init microfono non gestito",e),t.$captureException(e),t.manageMicError(e,null,(function(){return this.exitStep(),!0}))}))}}},mounted:function(){var t=this;this.$root.$emit("showPager",{show:!0}),this.$deviceInfo.getInfo().then((function(e){t.deviceInfo=e,t.$exerciseManager.setDeviceCode(e)})),this.$capacitor.isNativePlatform()&&(this.$closeStream(),this.$airlyn.checkMicPerm().then((function(e){if(console.log("Permessi al microfono garantiti?",e,JSON.stringify(e)),e&&!0===e.result)console.log("permessi OK!");else{var i={name:"NotAllowedError",exception:e};t.manageMicError(i,null,(function(){return this.exitStep(),!0}))}})).catch((function(e){console.error("Permission request fails",e),t.manageMicError({name:"NotAllowedError",exception:e},null,(function(){return this.exitStep(),!0}))}))),this.$nextTick((function(){t.$root.$emit("showPager",{show:!0}),t.$root.$emit("setNextText",t.$t("generic.start_chevron")),t.$root.$emit("disableNext",!0)})),this.intervals.push(setTimeout((function(){t.$nextTick((function(){t.setupAll()}))}),700))}},h=n(42),d=Object(h.a)(l,(function(){var t=this,e=t._self._c;return e("fullpage-card",{staticClass:"center-title noise exercisecc",attrs:{hidefooter:!0},scopedSlots:t._u([{key:"header",fn:function(){return[e("v-row",{staticClass:"navigation",attrs:{"align-content":"center",justify:"center"}},[e("div",{staticClass:"exercise__title"},[e("span",[t._v(t._s(t.$t("generic.soundcheck")))])])])]},proxy:!0},{key:"body",fn:function(){return[e("div",{directives:[{name:"show",rawName:"v-show",value:t.getCurrentExercise,expression:"getCurrentExercise"}],key:t.countdownrunning,staticClass:"exercises__container noisechecker"},[e("exerciseanimationprogress",{key:t.countdownrunning,staticClass:"finished",attrs:{exerciseSteps:0,startPercent:0,maxPercent:0,doneClass:"doneNone",runningPercent:t.currentPercent},scopedSlots:t._u([{key:"inside",fn:function(){return[e("div",{staticClass:"timer text-center noise"},[e("transition",{attrs:{mode:"out-in",name:"exittop"}},[t.timer<t.timerLength&&t.countdownrunning?e("p",{key:t.finish&&t.loading&&t.countdownrunning,domProps:{innerHTML:t._s(t.$t("generic.noisestart"))}}):t._e(),t._v(" "),!t.finish&&t.loading?e("p",{key:!t.finish&&t.loading,domProps:{innerHTML:t._s(t.$t("ml_exercise.almostdone"))}}):t._e(),t._v(" "),t.finish&&!t.loading?e("p",{key:t.finish&&!t.loading,domProps:{innerHTML:t._s(t.$t("generic.noiseready"))}}):t._e()])],1)]},proxy:!0}]),model:{value:t.timer,callback:function(e){t.timer=e},expression:"timer"}}),t._v(" "),e("div",{staticStyle:{display:"none"}},[e("b",[t._v("Debug")]),e("br"),t._v(" "),e("p",[t._v("Peak dB:"),e("b",[t._v(t._s(t.audioLevels.peakLevel))])]),e("br"),t._v(" "),e("p",[t._v("Average dB:"),e("b",[t._v(t._s(t.audioLevels.averageLevel))])])])],1),t._v(" "),e("CountDownItem",{ref:"noisecountdown",attrs:{timerLength:1e3*t.timerLength,interval:500},on:{progress:t.timerChange,end:t.timerEnd}}),t._v(" "),e("v-bottom-sheet",{attrs:{persistent:"","overlay-opacity":.9},model:{value:t.bottomsheet.show||t.hasWarning,callback:function(e){t.$set(t.bottomsheet,"show||hasWarning",e)},expression:"bottomsheet.show||hasWarning"}},[e("div",{staticClass:"bottomsheet"},[e("div",{staticClass:"text"},[t._v("\n          "+t._s(t.errorMessage||t.$t("generic.noisewarning"))+"\n        ")]),t._v(" "),e("div",{staticClass:"actions"},[e("v-btn",{attrs:{color:"leavevm",text:"",nuxt:"",outlined:""},on:{click:t.nextStep}},[e("div",{staticClass:"btncustomcontent",domProps:{innerHTML:t._s(t.$t("generic.startanyway"))}})]),t._v(" "),e("v-spacer"),t._v(" "),e("v-btn",{attrs:{color:"nextvm",nuxt:""},on:{click:t.retryNoise}},[e("span",{domProps:{innerHTML:t._s(t.$t("generic.retry"))}}),t._v(" "),e("v-icon",[t._v("mdi-reload")])],1)],1)])])]},proxy:!0},{key:"footer",fn:function(){return[e("a",{staticStyle:{display:"none"},attrs:{href:"#",id:"downloader"}},[t._v("Download audio")]),t._v(" "),e("div",{class:["leaveFab",t.countdownrunning?"":"disabled"]},[e("v-btn",{staticClass:"leavebtn",attrs:{icon:"",disabled:!t.countdownrunning},on:{click:t.leaveMe}},[e("v-icon",{attrs:{"x-small":""}},[t._v("mdi-window-close")])],1)],1)]},proxy:!0}])})}),[],!1,null,null,null);i.default=d.exports;installComponents(d,{Exerciseanimationprogress:n(927).default,FullpageCard:n(219).default})}}]);
//# sourceMappingURL=2a0540f.js.map